<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Triple Ripple</title>
		<meta name="viewport" content="initial-scale=1, user-scalable=no">
		<style>
			body {margin: 0;}
			#el {
				width: 160px;
				height: 240px;
				position: absolute;
				overflow: hidden;
			}
		</style>
		<script>
			var w = 160;
			var h = 240;
			window.onload = function() {
				var ctx = el.getContext('2d');
				var drawCalls = [];
				function ripple(t, x, y, o) {
					ctx.beginPath();
					ctx.arc(x,y,t*500,0,Math.PI*2,true);
					ctx.fillStyle = "rgba(255,255,255," + (1-t)*o + ")";
					ctx.fill();
				}
				el.addEventListener('click', function(e) {
					triggerRipple(
						e.pageX - this.offsetLeft,
						e.pageY - this.offsetTop
					);
				});
				function triggerRipple(x,y) {
					addDrawCall(x,y,3000);
				}
				function addDrawCall(x,y, duration) {
					var startTime = Date.now();
					drawCalls.push(function(now) {
						doubleRipple((now-startTime)/3000,x,y)
					});
					setTimeout(function() {
						drawCalls.shift();
					},duration);
				}
				function doubleRipple(t, x, y) {
					ripple(t, x, y, 1);


					ripple(t,-x,y,0.2);
					ripple(t,x,-y,0.2);
					ripple(t,w*2-x,y,0.2);
					ripple(t,x,h*2-y,0.2);


					ripple(t,w*2+x,y,0.05);
					ripple(t,w*2+x,y,0.05);
					ripple(t,x,h*2+y,0.05);
					ripple(t,x,h*2+y,0.05);

					ripple(t,-x,-y,0.05);
					ripple(t,w*2-x,-y,0.05);
					ripple(t,w*2-x,h*2-y,0.05);
					ripple(t,-x,h*2-y,0.05);
				}
				function animate() {
					ctx.beginPath()
					ctx.fillStyle = "red";
					ctx.fillRect(0,0,500,500);
					for (var i in drawCalls) {
						drawCalls[i](Date.now());
					}
					requestAnimationFrame(animate);
				} animate();
			}
		</script>
	</head>
	<body>
		<canvas id="el" height=240 width=160></canvas>
	</body>
</html>